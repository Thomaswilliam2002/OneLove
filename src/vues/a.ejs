<!DOCTYPE html>
<html lang="en">

  
<!-- Mirrored from buybootstrap.com/demos/medflex/medflex-admin-dashboard/accordions.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 15 May 2025 12:16:35 GMT -->
<%- include('head')%>

  <body>

    <!-- Page wrapper starts -->
    <div class="page-wrapper">

      <!-- App header starts -->
      <%- include('header')%>
      <!-- App header ends -->

      <!-- Main container starts -->
      <div class="main-container">

        <!-- Sidebar wrapper starts -->
        <%- include('menu')%>
        <!-- Sidebar wrapper ends -->

        <!-- App container starts -->
        <div class="app-container">

          <!-- App hero header starts -->
          <div class="app-hero-header d-flex align-items-center">

            <!-- Breadcrumb starts -->
            <ol class="breadcrumb">
              <li class="breadcrumb-item">
                <i class="ri-home-8-line lh-1 pe-3 me-3 border-end"></i>
                <a href="/index">Accueil</a>
              </li>
              <li class="breadcrumb-item text-primary" aria-current="page">
                Liste des Historiques du Produit <%= produit.nom %>
              </li>
            </ol>
            <!-- Breadcrumb ends -->

            <!-- Sales stats starts -->
            
            <!-- Sales stats ends -->

          </div>
          <!-- App Hero header ends -->

          <!-- App body starts -->
          <div class="app-body">

            <% if(msg) {%>
              <% if(type === 'achat') {%>
                <% if(msg === 'ajout') {%>
                  <div class="alert bg-white border alert-dismissible fade show text-success" role="alert">
                    <b>Achat </b> ajouter avec succes !
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                <% }%>
                <% if(msg === 'modif') {%>
                  <div class="alert bg-white border alert-dismissible fade show text-info" role="alert">
                    <b>Achat </b> modifier avec succes !
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                <% }%>
                <% if(msg === 'sup') {%>
                  <div class="alert bg-white border alert-dismissible fade show text-danger" role="alert">
                    <b>Achat </b> supprimer avec succes !
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                <% }%>
              <% }%>
              <% if(type === 'vente') {%>
                <% if(msg === 'ajout') {%>
                  <div class="alert bg-white border alert-dismissible fade show text-success" role="alert">
                    <b>Vente </b> ajouter avec succes !
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                <% }%>
                <% if(msg === 'modif') {%>
                  <div class="alert bg-white border alert-dismissible fade show text-info" role="alert">
                    <b>Vente </b> modifier avec succes !
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                <% }%>
                <% if(msg === 'sup') {%>
                  <div class="alert bg-white border alert-dismissible fade show text-danger" role="alert">
                    <b>Vente </b> supprimer avec succes !
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                <% }%>
              <% }%>
            <% }%>

            <!-- Row starts -->
            <div class="row gx-3">
              <div class="col-sm-12">
                <div class="accordion mb-3" id="accordionSpecialTitle<%= produit.id_produit %>">
                  <div class="accordion-item ">
                    <div >
                        <h2 class="accordion-header" id="headingSpecialTitle<%= produit.id_produit %>">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseSpecialTitle<%= produit.id_produit %>" aria-expanded="true"
                            aria-controls="collapseSpecialTitle<%= produit.id_produit %>">
                            <div class="d-flex flex-column">
                              <h5>Historique des achat/Entrer de produit</h5>
                            </div>
                          </button>
                        </h2>
                    </div>
                    
                    <div id="collapseSpecialTitle<%= produit.id_produit %>" class="accordion-collapse collapse "
                      aria-labelledby="headingSpecialTitle<%= produit.id_produit %>" data-bs-parent="#accordionSpecialTitle<%= produit.id_produit %>">
                      <div class="accordion-body">
                        <div class="table-responsive">
                          <table  class="table truncate m-0 align-middle " >
                            <thead class="text-center">
                              <tr>
                                <th>ID</th>
                                <th>Quantiter AJouter</th>
                                <th>Prix a l'uniter</th>
                                <th>Montant</th>
                                <th>Emmeteur</th>
                                <th>Date de l'operation</th>
                                <th>Heure de l'operation</th>
                                <th>Action</th>
                              </tr>
                            </thead>
                            <tbody class="text-center">
                              <% i = 1; total_q = 0; total_p = 0; montant = 0; hachats.forEach(hachat => {%>
                              <tr>
                                <td><%= i %></td>
                                <td><%= hachat.quantiter %></td>
                                <td><%= hachat.prix_unit %></td>
                                <td><%= hachat.prix_unit * hachat.quantiter %></td>
                                <td><%= hachat.donneur %></td>
                                <td><%= new Date(hachat.created).getDate() %>-<%= new Date(hachat.created).getMonth() + 1 %>-<%= new Date(hachat.created).getFullYear()%></td>
                                <td><%= new Date(hachat.created).getHours() %>-<%= new Date(hachat.created).getMinutes() %>-<%= new Date(hachat.created).getSeconds()%></td>
                                <td>
                                  <div class="d-inline-flex gap-1">
                                    <!-- ----------------------------------------------------------------------------------- -->
                                   
                                      <!-- Card starts -->
                                          <!-- Button trigger modal -->
                                          <button type="button" data-bs-toggle="modal"
                                            data-bs-target="#<%= hachat.id_hist %>ModalCenter" class="btn btn-outline-danger btn-sm">
                                            <i class="ri-delete-bin-line"></i>
                                          </button>
                                          <!-- Modal -->
                                          <div class="modal fade" id="<%= hachat.id_hist %>ModalCenter" tabindex="-1"
                                            aria-labelledby="personnel.id_personnelModalCenterTitle" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered">
                                              <div class="modal-content">
                                                <div class="modal-header">
                                                  <h5 class="modal-title" id="<%= hachat.id_hist %>ModalCenterTitle">
                                                    Confirmer
                                                  </h5>
                                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                  <p>Voulez-vous vraiment supprimer cet Historique ?</p>
                                                </div>
                                                <div class="modal-footer">
                                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                                    annuler
                                                  </button>
                                                  <form action="/deleteHEntrer/<%= hachat.id_hist %>?_method=DELETE&id=<%= produit.id_produit %>" method="post">
                                                    <div class="col-sm-12">
                                                      <div class="d-flex gap-2 justify-content-end">
                                                        <button type="submit" class="btn btn-danger">Supprimer</button>
                                                      </div>
                                                    </div>
                                                  </form>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                      <!-- Card ends -->
                                    
                                    <!-- ----------------------------------------------------------------------------------------- -->
                                    
                                  </div>
                                </td>
                              </tr>
                              <% i++; total_p += hachat.prix_unit; total_q += hachat.quantiter; montant += hachat.prix_unit * hachat.quantiter}) %>
                              <th >Total</th>
                              <th ><%= total_q %></th>
                              <th ><%= total_p %></th>
                              <th ><%= montant %></th>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Row ends -->

            <!-- Row starts -->
            
            <!-- Row ends -->

          
            <!-- Row starts -->
            <div class="row gx-3">
              <div class="col-sm-12">
                <div class="accordion mb-3" id="<%= produit.id_produit %>accordionSpecialTitle<%= produit.id_produit %>">
                  <div class="accordion-item ">
                    <div >
                        <h2 class="accordion-header" id="<%= produit.id_produit %>headingSpecialTitle<%= produit.id_produit %>">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#<%= produit.id_produit %>collapseSpecialTitle<%= produit.id_produit %>" aria-expanded="true"
                            aria-controls="<%= produit.id_produit %>collapseSpecialTitle<%= produit.id_produit %>">
                            <div class="d-flex flex-column">
                              <h5>Historique des Ventes/Sortie de produit</h5>
                            </div>
                          </button>
                        </h2>
                    </div>
                    
                    <div id="<%= produit.id_produit %>collapseSpecialTitle<%= produit.id_produit %>" class="accordion-collapse collapse "
                      aria-labelledby="<%= produit.id_produit %>headingSpecialTitle<%= produit.id_produit %>" data-bs-parent="#<%= produit.id_produit %>accordionSpecialTitle<%= produit.id_produit %>">
                      <div class="accordion-body">
                        <div class="table-responsive">
                          <table id="basicExample" class="table truncate m-0 align-middle dataTable" aria-describedby="basicExample_filter">
                            <thead class="text-center">
                              <tr>
                                <th>ID</th>
                                <th>Quantiter Retirer</th>
                                <th>Prix a l'uniter</th>
                                <th>Montant</th>
                                <th>Destinataire</th>
                                <th>Date de l'operation</th>
                                <th>Heure de l'operation</th>
                                <th>Action</th> 
                              </tr>
                            </thead>
                            <tbody class="text-center">
                              <% i = 1; total_q = 0; total_p = 0; montant = 0; hventes.forEach(hvente => {%>
                              <tr>
                                <td><%= i %></td>
                                <td><%= hvente.quantiter %></td>
                                <td><%= hvente.prix_unit %></td>
                                <td><%= hvente.prix_unit * hvente.quantiter %></td>
                                <td><%= hvente.receveur %></td>
                                <td><%= new Date(hvente.created).getDate() %>-<%= new Date(hvente.created).getMonth() + 1 %>-<%= new Date(hvente.created).getFullYear()%></td>
                                <td><%= new Date(hvente.created).getHours() %>-<%= new Date(hvente.created).getMinutes() %>-<%= new Date(hvente.created).getSeconds()%></td>
                                <td>
                                  <div class="d-inline-flex gap-1">
                                    <!-- ----------------------------------------------------------------------------------- -->
                                   
                                      <!-- Card starts -->
                                          <!-- Button trigger modal -->
                                          <button type="button" data-bs-toggle="modal"
                                            data-bs-target="#<%= hvente.id_hist %>ModalCenter" class="btn btn-outline-danger btn-sm">
                                            <i class="ri-delete-bin-line"></i>
                                          </button>
                                          <!-- Modal -->
                                          <div class="modal fade" id="<%= hvente.id_hist %>ModalCenter" tabindex="-1"
                                            aria-labelledby="personnel.id_personnelModalCenterTitle" aria-hidden="true">
                                            <div class="modal-dialog modal-dialog-centered">
                                              <div class="modal-content">
                                                <div class="modal-header">
                                                  <h5 class="modal-title" id="<%= hvente.id_hist %>ModalCenterTitle">
                                                    Confirmer
                                                  </h5>
                                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                  <p>Voulez-vous vraiment supprimer la chambre ?</p>
                                                </div>
                                                <div class="modal-footer">
                                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                                    annuler
                                                  </button>
                                                  <form action="/deleteHSortie/<%= hvente.id_hist %>?_method=DELETE&id=<%= produit.id_produit %>" method="post">
                                                    <div class="col-sm-12">
                                                      <div class="d-flex gap-2 justify-content-end">
                                                        <button type="submit" class="btn btn-danger">Supprimer</button>
                                                      </div>
                                                    </div>
                                                  </form>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                      <!-- Card ends -->
                                    
                                    <!-- ----------------------------------------------------------------------------------------- -->
                                    
                                  </div>
                                </td>
                              </tr>
                              <% i++; total_p += hvente.prix_unit; total_q += hvente.quantiter; montant += hvente.prix_unit * hvente.quantiter}) %>
                              <th >Total</th>
                              <th ><%= total_q %></th>
                              <th ><%= total_p %></th>
                              <th ><%= montant %></th>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Row ends -->

            <!-- Row starts -->
            
            <!-- Row ends -->
            <div class="col-xxl-6 col-xl-12">
              <div class="card mb-3">
                <div class="card-header">
                  <h5 class="card-title">Courbre de variation des recette des Bar simple par ann√©e</h5>
                </div>
                <div class="card-body">
                  <div class="chart-height-xl">
                    <div id="areaGraph">
                      <!-- ---------------------------------------------------------------- -->
                      <div class="">
                        <div class="">
                          <div class="card-body">
                            <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="false">
                              <div class="carousel-indicators">
                                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0"
                                  class="active" aria-current="true" aria-label="Slide 1"></button>
                                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"
                                  aria-label="Slide 2"></button>
                                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"
                                  aria-label="Slide 3"></button>
                              </div>
                              <div class="carousel-inner pb-3" id="pp">

                              </div>

                              <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
                                data-bs-slide="prev" >
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                              </button>
                              <button class="carousel-control-next " type="button" data-bs-target="#carouselExampleIndicators"
                                data-bs-slide="next" >
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                              </button>

                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- ---------------------------------------------------------------- -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- App body ends -->

          <!-- App footer starts -->
          
          <!-- App footer ends -->

        </div>
        <!-- App container ends -->

      </div>
      <!-- Main container ends -->

    </div>
    <!-- Page wrapper ends -->

    <!-- *************
			************ JavaScript Files *************
		************* -->
    <!-- Required jQuery first, then Bootstrap Bundle JS -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/moment.min.js"></script>
    <!-- Overlay Scroll JS -->
    <script src="assets/vendor/overlay-scroll/jquery.overlayScrollbars.min.js"></script>
    <script src="assets/vendor/overlay-scroll/custom-scrollbar.js"></script>

    <!-- Apex Charts -->
    <script src="assets/vendor/apex/apexcharts.min.js"></script>
    
    <!-- Data Tables -->
    <script src="assets/vendor/datatables/dataTables.min.js"></script>
    <script src="assets/vendor/datatables/dataTables.bootstrap.min.js"></script>
    <script src="assets/vendor/datatables/custom/custom-datatables.js"></script>

    <!-- Custom JS files -->
    <script src="assets/js/custom.js"></script>
    <script src="assets/js/table-random-colors.js"></script>

    <script>
      const text_colore = ['text-primary', 'text-info', 'text-danger', 'text-warning', 'text-success']
      const class_colore = ['badge bg-primary', 'badge bg-info', 'badge bg-danger', 'badge bg-warning', 'badge bg-success']
      traduct = (date) => {
          const dates = new Date(`${date.split('-')[0]}-${date.split('-')[1]}-01`);
          const shortMonth = dates.toLocaleString('en-US', {month: 'short'});
          return shortMonth;
      }
      
      const pp = document.getElementById('pp');
      const tbody = document.getElementById('tbody');
      const anner = []

      const recettee = JSON.parse('<%- JSON.stringify(histe) %>')
      console.log(recettee)

      const recettes = JSON.parse('<%- JSON.stringify(hists) %>')
      console.log(recettes)

      recettee.forEach(element => {
        if(!anner.includes(element.mois.split('-')[0])){
          anner.push(element.mois.split('-')[0])
        }
      });

      recettes.forEach(element => {
        if(!anner.includes(element.mois.split('-')[0])){
          anner.push(element.mois.split('-')[0])
        }
      });
      console.log(anner)

      // ----------------------------------------------------------------------
      anner.forEach((anner, ia) => {
        let nb_he = 0
        let nb_hs = 0
          
        recettee.forEach(element => {
          nb_he++
        });

        let h = 1
        recettes.forEach(element => {
          nb_hs++
        });

        console.log(nb_he, nb_hs)
        pp.insertAdjacentHTML('beforeend',`
          <div class="card-body carousel-item ${ia === 0? 'active' : ''}" id="p${ia}">
          </div>
        `)

        const p = document.getElementById(`p${ia}`);

        for(let j = 0; j < nb_he; j++){
          console.log("ok")
          const all_month = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",]
          const recette_e = Array(12).fill(0);
          const recette_s = Array(12).fill(0);
          for(let i = 0; i < all_month.length; i++){
            //console.log(traduct(recettee[j].mois), recettee[j].mois, all_month[i])
            if(recettee[j]){
              if(all_month[i] === traduct(recettee[j].mois) && anner === recettee[j].mois.split('-')[0]){
                recette_e[i] = recettee[j].recette
              }
            }
            if(recettes[j]){
              if(all_month[i] === traduct(recettes[j].mois) && anner === recettes[j].mois.split('-')[0]){
                recette_s[i] = recettes[j].recette
              }
            }
          }
          //console.log(JSON.stringify(recette_e) !== JSON.stringify(Array(12).fill(0)) || JSON.stringify(recette_s) !== JSON.stringify(Array(12).fill(0)))
          if(JSON.stringify(recette_e) !== JSON.stringify(Array(12).fill(0)) || JSON.stringify(recette_s) !== JSON.stringify(Array(12).fill(0))){
            exi = document.getElementById(`#income${ia}`);
            console.log(exi)
            if(!exi){
              p.insertAdjacentHTML('beforeend',`
                <div class="chart-height-lg">
                    <div id="income${ia}" ></div>
                </div>
              `)
            }

            const hot = document.getElementById(`income${ia}`);
            hot.insertAdjacentHTML('beforeend',`
              <div class="" id="d${ia}-${anner}">
              </div>
            `)

            // ============================================================
            var options = {
              chart: {
                height: 300,
                type: "area",
                toolbar: {
                  show: false,
                },
              },
              dataLabels: {
                enabled: false,
              },
              stroke: {
                curve: "smooth",
                width: 3,
              },
              series: [
                {
                  name: "Achat/Entrer",
                  data: recette_e,
                },
                {
                  name: "Sortie/Vente",
                  data: recette_s,
                },
              ],
              grid: {
                borderColor: "#dfd6ff",
                strokeDashArray: 5,
                xaxis: {
                  lines: {
                    show: true,
                  },
                },
                yaxis: {
                  lines: {
                    show: false,
                  },
                },
                padding: {
                  top: 0,
                  right: 0,
                  bottom: 10,
                  left: 0,
                },
              },
              xaxis: {
                categories: [
                  "Jan",
                  "Feb",
                  "Mar",
                  "Apr",
                  "May",
                  "Jun",
                  "Jul",
                  "Aug",
                  "Sep",
                  "Oct",
                  "Nov",
                  "Dec",
                ],
              },
              yaxis: {
                labels: {
                  show: false,
                },
              },
              colors: [
                "#207a5a",
                "#248a65",
                "#116aef",
                "#3ea37e",
                "#53ad8d",
                "#69b89b",
                "#7ec2a9",
                "#94ccb8",
                "#a9d6c6",
              ],
              markers: {
                size: 0,
                opacity: 0.3,
                colors: [
                  "#2f477a",
                  "#35508a",
                  "#3b5999",
                  "#4f6aa3",
                  "#627aad",
                  "#768bb8",
                  "#899bc2",
                  "#9daccc",
                ],
                strokeColor: "#ffffff",
                strokeWidth: 2,
                hover: {
                  size: 7,
                },
              },
            };

            var chart = new ApexCharts(document.querySelector(`#d${ia}-${anner}`), options);

            chart.render();

          // ============================================================
          }
          console.log('=>',recette_e)
          console.log('=>',recette_s)
        }

      
        // nb_he.forEach((id, index) => {
        //   const all_month = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",]
        //   const recette_t = Array(12).fill(0);
        //   recettee.forEach(element => {
        //     if(element.id_probal === id && anner === element.mois.split('-')[0]){
        //       for(let j = 0; j < all_month.length; j++){
        //         if(all_month[j] === traduct(element.mois)){
        //           //console.log(element.total_recette, typeof element.total_recette)
        //           recettes[j] = element.total_recette
        //         }
        //       }
        //     }
        //   })
        // })
      })
    </script>
  </body>
  

<!-- Mirrored from buybootstrap.com/demos/medflex/medflex-admin-dashboard/accordions.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 15 May 2025 12:16:35 GMT -->
</html>

<script>
  let all_tva = []
  tbody = document.getElementById('tbody');
  add = document.getElementById('btnadd');
  const mtnp = document.getElementById('mtnp');
  const rms = document.getElementById('rms');
  const prms = document.getElementById('prms');
  const ttc = document.getElementById('ttc');
  const tvap = document.getElementById('tva');
  const cible = document.getElementById('cible');
  //montan_net = 0;
  let i = 0;
  add.addEventListener('click', () => {
    cible.insertAdjacentHTML('beforebegin',
    `
    <tr class="trow" id="row${i}">
      <td class="ttrow">
        <input type="text" class="form-control" id="pd${i}">
      </td>
      <td>
        <!-- Form group start -->
        <div class="m-0">
          <input type="number" value="0" class="form-control" min="0" step="0.01"  id="qt${i}">
        </div>
        <!-- Form group end -->
      </td>
      <td>
        <!-- Form group start -->
        <div class="m-0">
          <input type="number" min="0" value="0" step="0.01" class="form-control"  id="unit${i}">
        </div>
        <!-- Form group end -->
      </td>
      <td>
        <!-- Form group start -->
        <div class="input-group m-0">
          <input type="number" min="0" value="0" step="0.01" class="form-control"  id="price${i}">
          <span class="input-group-text">
            <i class="ri-money-dollar-circle-line"></i>
          </span>
        </div>
        <!-- Form group end -->
      </td>
      <td>
        <!-- Form group start -->
        <div class="input-group m-0">
          <input type="number" min="0" value="0" step="0.01" class="form-control tva"  id="tva${i}">
          <span class="input-group-text">%</span>
        </div>
        <!-- Form group end -->
      </td>
      <td>
        <!-- Form group start -->
        <div class="input-group m-0">
          <input type="number" min="0" value="0" step="0.01" class="form-control mtn"  id="mtn${i}">
          <span class="input-group-text">
            <i class="ri-money-dollar-circle-line"></i>
          </span>
        </div>
        <!-- Form group end -->
      </td>
      <td>
        <div class="d-inline-flex gap-1">
          <button class="btn btn-outline-danger delrow" id="${i}" onclick="delet('${i}')">
            <i class="ri-delete-bin-line"></i>
          </button>
        </div>
      </td>
    </tr>
    `)
    row(i)
    all_tva.push(0)
    // prix = document.getElementById('price' + i)
    // qt = document.getElementById('qt' + i)
    // mtn = document.getElementById('mtn' + i)
    // tva = document.getElementById('tva' + i)
    // unit = document.getElementById('unit' + i)
    i++;
    // setInterval(surveil(),100);
    
  })

  function f_mtnp(){
    let total = 0
    listMtn = tbody.querySelectorAll('.mtn')
    listMtn.forEach(mtn => {
      if(mtn.value){
        total += mtn.valueAsNumber;
      }
    });
    return total
  }

  function addEventListenerOnce(element, event, listener, data){
      //on verifie si l'ementent a deja une proprieter listener
      if(!element){
          console.log('no')
          return
      }
      if(!element.listeners){
          element.listeners = {}
      }
      //on verifie si l'element a deja une liste d'ecouteur pour l'evenement specifique
      if(!element.listeners[event]){
          element.listeners[event] = []
      }
      if(!element.listeners[event].includes(listener)){
          element.addEventListener(event, () => {listener(data)})
          element.listeners[event].push(listener)
      }
  }

  //fonction pour calculer la remise
  const remise = () => {
    //console.log(prms.value, typeof prms.value)
    let res = 0
    if(!prms.value){
      res = 0.00
    }else{
      res = +(ttc.dataset.value - (ttc.dataset.value - ((prms.valueAsNumber / 100) * ttc.dataset.value))).toFixed(2)
    }
    rms.dataset.value = res
    rms.innerText = res + ' FCFA'
    TTC()
  }

  //appliquer un listenner a pourcentage de remise
  prms.addEventListener('input', remise)

  //fonction qui gere le prix et la quantiter sur chaque ligne
  const p_q = (data) => {
    if(!data[0].value || !data[1].value){
      data[2].value = 0
    }else{
      data[2].value = data[0].valueAsNumber * data[1].valueAsNumber
      Tva([data[3], data[4], data[2], data[0], data[1], data[5]])
    }
  }
  
  //fonction qui ajoute la TVA a chaque produit
  const Tva = (data) => {
    //calculer le montant net avec/sans la tva
    //console.log(typeof data[3].valueAsNumber)
    let sumtva = 0
    if(data[1].value){
      all_tva[data[5]] = +((data[1].valueAsNumber / 100) * data[2].valueAsNumber).toFixed(2)
    }

    if(!data[1].value  || !data[2].value){
      data[0].value = 0
    }else if(data[2].value === 0 || data[1].value === null){
      data[0].value = data[3].valueAsNumber * data[4].valueAsNumber
    }else{
      let tva = (data[1].valueAsNumber / 100) * data[2].valueAsNumber
      data[0].value = tva + data[2].valueAsNumber
    }

    for(let i = 0;i < all_tva.length;i++){
      sumtva += all_tva[i]
    }

    if(sumtva !== 0){
      tvap.innerText = sumtva + ' FCFA'
    }
    // console.log(all_tva)
    // console.log(all_tva[0], all_tva)
    TTC()
    remise()
  }
  
  //fonction qui ajoute le TTC
  const TTC = (row_id) => {
    all_ttc = tbody.querySelectorAll('.mtn');
    let sum = 0
    all_ttc.forEach((element, id) => {
      sum += element.valueAsNumber
    })
    //console.log(rms.dataset.value)
    ttc.dataset.value = +(sum - rms.dataset.value).toFixed(2)
    ttc.innerText = +(sum - rms.dataset.value).toFixed(2) + ' FCFA'
  }

  //fonction qui ajoute le TTC
  const TVA = (tva) => {
    all_tva = tbody.querySelectorAll('.tva');
    let sum = 0
    all_ttc.forEach((element, id) => {
      sum += element.valueAsNumber
    })
    ttc.dataset.value = sum
    ttc.innerText = sum + ' FCFA'
  }

  const row = (row_id) => {
    const prix = document.getElementById('price' + row_id)
    const qt = document.getElementById('qt' + row_id)
    const mtn = document.getElementById('mtn' + row_id)
    const tva = document.getElementById('tva' + row_id)
    const unit = document.getElementById('unit' + row_id)
    

    addEventListenerOnce(qt, 'input', p_q, [unit, qt, prix, mtn, tva, row_id])
    addEventListenerOnce(unit, 'input', p_q, [unit, qt, prix, mtn, tva, row_id])
    addEventListenerOnce(tva, 'input', Tva, [mtn, tva, prix, unit, qt, row_id])
  }

  
</script>